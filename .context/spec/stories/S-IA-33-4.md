# S-IA-33-4: Centrality Visualization

**Epic:** E-33 (Course & Teaching Analytics)
**Feature:** F-15
**Sprint:** 18
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **Institutional Admin**, I need graph centrality visualizations showing PageRank and betweenness metrics so that I can identify the most critical and interconnected concepts in the curriculum knowledge graph.

## Acceptance Criteria
- [ ] PageRank visualization: bar chart ranking top concepts by PageRank score
- [ ] Betweenness centrality: bar chart ranking concepts by betweenness score
- [ ] Interactive graph view: D3 force-directed graph with node size proportional to centrality
- [ ] Node coloring: color by course, Bloom level, or centrality metric (selectable)
- [ ] Edge display: shows relationships between concepts (prerequisite, related, part-of)
- [ ] Hover details: tooltip showing concept name, centrality scores, connected SLOs
- [ ] Scope filter: institution-wide or per-course graph view
- [ ] Centrality metrics computed via Neo4j GDS (Graph Data Science) algorithms
- [ ] 8-12 API tests: centrality queries, graph data assembly, scope filtering
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/analytics/centrality.types.ts` |
| Service | apps/server | `src/services/analytics/centrality.service.ts` |
| Controller | apps/server | `src/controllers/analytics/centrality.controller.ts` |
| View | apps/web | `src/app/(dashboard)/admin/analytics/graph/page.tsx`, `src/components/analytics/CentralityBarChart.tsx`, `src/components/analytics/KnowledgeGraphViz.tsx`, `src/components/analytics/GraphControls.tsx` |
| Tests | apps/server | `src/tests/analytics/centrality.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-IA-33-1 (analytics infrastructure exists)
- **Cross-epic:** none

## Notes
- Neo4j GDS algorithms: `gds.pageRank.stream`, `gds.betweenness.stream` â€” require GDS plugin
- D3 force-directed graph: use `d3-force` with React wrapper (no raw DOM manipulation)
- Graph rendering performance: limit displayed nodes to top 100 by centrality; expandable on demand
- Node size: min 8px, max 40px, scaled linearly by centrality score
- Edge thickness: proportional to relationship weight (if available)
- Consider WebGL renderer (e.g., `@react-sigma/core`) for graphs > 500 nodes
- Centrality results cached in Supabase with TTL (recomputed nightly or on-demand)
