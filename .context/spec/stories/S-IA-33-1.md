# S-IA-33-1: Course Analytics Page

**Epic:** E-33 (Course & Teaching Analytics)
**Feature:** F-15
**Sprint:** 18
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **Institutional Admin**, I need a course analytics page showing item statistics and Bloom/USMLE distribution charts so that I can assess the quality and alignment of generated content per course.

## Acceptance Criteria
- [ ] Course selector: dropdown to choose course for analysis
- [ ] KPI cards: total items, approved rate, average quality score, SLO coverage %
- [ ] Bloom distribution chart: bar chart showing question counts per Bloom level
- [ ] USMLE system distribution: bar chart showing question counts per USMLE system
- [ ] Difficulty distribution: pie chart showing easy/medium/hard breakdown
- [ ] Quality trend: line chart of average composite score over time
- [ ] Generation velocity: items generated per week trend line
- [ ] Filterable by date range and question type
- [ ] 8-12 API tests: analytics queries, course scoping, date filtering, aggregate accuracy
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/analytics/course-analytics.types.ts` |
| Service | apps/server | `src/services/analytics/course-analytics.service.ts` |
| Controller | apps/server | `src/controllers/analytics/course-analytics.controller.ts` |
| View | apps/web | `src/app/(dashboard)/admin/analytics/courses/page.tsx`, `src/components/analytics/CourseKPICards.tsx`, `src/components/analytics/BloomDistributionChart.tsx`, `src/components/analytics/USMLEDistributionChart.tsx` |
| Tests | apps/server | `src/tests/analytics/course-analytics.test.ts` |

## Dependencies
- **Blocks:** S-IA-33-3
- **Blocked by:** S-IA-28-1 (coverage data exists)
- **Cross-epic:** S-IA-28-1 (Sprint 15 coverage computation)

## Notes
- Analytics queries aggregate from Supabase `questions` table with joins to tags and scores
- Charts built with recharts — consistent with item bank statistics charts
- Consider Supabase materialized views for expensive aggregate queries
- Course selector shows only courses the admin has access to (RBAC scoped)
- Date range default: last 30 days, with presets for 7d, 30d, 90d, all-time
- Design tokens for chart colors — use a consistent palette across all analytics pages
