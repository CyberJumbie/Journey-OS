# S-F-38-3: Generation Settings

**Epic:** E-38 (Profile & Preferences)
**Feature:** F-18
**Sprint:** 19
**Lane:** faculty (P3)
**Size:** S

## User Story
As a **Faculty member**, I need generation settings to configure my automation level preference and interrupt behavior so that the AI generation workflow matches my preferred interaction style.

## Acceptance Criteria
- [ ] Automation level selector: user-level preference (overridden by institution setting if stricter)
- [ ] Options: "Let AI handle it" (full auto), "Pause at checkpoints" (checkpoints), "Review everything" (manual)
- [ ] Interrupt preference: "Pause before critic scoring" toggle
- [ ] Default generation parameters: preferred difficulty distribution, Bloom focus
- [ ] Settings saved to Supabase `user_preferences` JSONB
- [ ] Workbench reads these defaults on load (pre-fills generation form)
- [ ] Clear explanation of each option with expected workflow impact
- [ ] 5-8 API tests: preference CRUD, institution override logic, workbench reads defaults
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/user/generation-prefs.types.ts` |
| Service | apps/server | `src/services/user/generation-prefs.service.ts` |
| View | apps/web | `src/app/(dashboard)/settings/generation/page.tsx`, `src/components/settings/GenerationPrefsForm.tsx` |
| Tests | apps/server | `src/tests/user/generation-prefs.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-F-38-1 (profile page exists as settings parent)
- **Cross-epic:** S-F-22-3 (automation level config — user pref cannot exceed institution strictness)

## Notes
- Institution override: if institution is set to "manual", user cannot select "full auto" — show disabled option with explanation
- Override logic: `effectiveLevel = max(institutionLevel, userLevel)` where manual > checkpoints > full_auto
- Default generation params merge with template params when both exist (template takes precedence)
- Settings URL: `/settings/generation` — tab under settings layout
- Consider showing a preview of the generation workflow for each automation level option
- Radio group for automation level, toggle switches for interrupt preferences
