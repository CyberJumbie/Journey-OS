# S-ST-40-1: FastAPI Service Scaffold

**Epic:** E-40 (BKT & IRT Engine)
**Feature:** F-19
**Sprint:** 31
**Lane:** student (P4)
**Size:** M

## User Story
As a **developer**, I need a Python/FastAPI service scaffold with health check, authentication, and CORS so that the IRT and BKT algorithms have a production-ready runtime environment.

## Acceptance Criteria
- [ ] FastAPI application in packages/python-api with project structure
- [ ] Health check endpoint: GET /health returning service status
- [ ] JWT authentication middleware validating Supabase tokens
- [ ] CORS configuration matching apps/server settings
- [ ] Environment configuration via pydantic-settings (.env)
- [ ] Structured logging with correlation IDs
- [ ] Error handling middleware with custom error classes
- [ ] Docker configuration for local development and production
- [ ] Poetry/uv for dependency management with lock file
- [ ] OpenAPI documentation auto-generated at /docs
- [ ] pytest setup with fixtures for auth and database
- [ ] Neo4j driver connection pool (neo4j Python driver)
- [ ] Supabase client initialization (supabase-py)

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Config | packages/python-api | `src/config.py`, `src/settings.py` |
| App | packages/python-api | `src/main.py`, `src/app.py` |
| Middleware | packages/python-api | `src/middleware/auth.py`, `src/middleware/cors.py`, `src/middleware/error_handler.py` |
| Database | packages/python-api | `src/database/neo4j_client.py`, `src/database/supabase_client.py` |
| Health | packages/python-api | `src/routes/health.py` |
| Docker | packages/python-api | `Dockerfile`, `docker-compose.yml` |
| Tests | packages/python-api | `tests/conftest.py`, `tests/test_health.py`, `tests/test_auth.py` |

## Dependencies
- **Blocks:** S-ST-40-2, S-ST-40-3, S-ST-40-4
- **Blocked by:** S-U-01-3 (Supabase auth for JWT validation)
- **Cross-epic:** Foundation for all Python services (E-44 risk engine reuses this)

## Notes
- This scaffold is reused by E-44 (Risk Prediction Engine) in Sprint 37.
- JWT validation must match Supabase token format and verify against Supabase JWKS.
- Neo4j Python driver uses async with `neo4j.AsyncGraphDatabase`.
- Follow OOP patterns: private fields, public getters, constructor DI (adapted for Python).
- Python version: 3.11+ for performance and typing improvements.
