# S-IA-30-1: Compliance Computation Service

**Epic:** E-30 (LCME Compliance Engine)
**Feature:** F-14
**Sprint:** 39
**Lane:** institutional_admin (P2)
**Size:** L

## User Story
As an **institutional admin**, I need the system to compute LCME compliance evidence chains by traversing the curriculum graph so that I can see which standards are fully met, partially met, or unmet.

## Acceptance Criteria
- [ ] Graph traversal: LCME_Element <- ILO <- SLO <- Course chain via Neo4j
- [ ] Compute compliance status per element: met (100% coverage), partial (1-99%), unmet (0%)
- [ ] Coverage metric: percentage of required evidence present for each element
- [ ] Aggregate by standard: 12 LCME standards, each with multiple elements
- [ ] Standard compliance = weighted average of element compliance within that standard
- [ ] Evidence chain includes: which ILOs map to element, which SLOs map to ILO, which courses deliver SLO
- [ ] Performance: full institution computation in < 5 minutes
- [ ] Results cached with invalidation on curriculum changes
- [ ] API endpoint: GET /api/compliance/compute/:institutionId
- [ ] Incremental recompute: only affected chains when single mapping changes
- [ ] Audit log: when computation ran, by whom, results hash

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/compliance/compliance.types.ts` |
| Model | apps/server | `src/modules/compliance/models/compliance-result.model.ts` |
| Repository | apps/server | `src/modules/compliance/repositories/compliance.repository.ts` |
| Service | apps/server | `src/modules/compliance/services/compliance-computation.service.ts` |
| Service | apps/server | `src/modules/compliance/services/evidence-chain-traversal.service.ts` |
| Controller | apps/server | `src/modules/compliance/controllers/compliance.controller.ts` |
| Route | apps/server | `src/modules/compliance/routes/compliance.routes.ts` |
| Seed | apps/server | `src/modules/compliance/seeds/lcme-standards.seed.ts` |
| API Tests | apps/server | `src/modules/compliance/__tests__/compliance-computation.service.test.ts` |
| API Tests | apps/server | `src/modules/compliance/__tests__/evidence-chain-traversal.test.ts` |
| API Tests | apps/server | `src/modules/compliance/__tests__/compliance.repository.test.ts` |
| API Tests | apps/server | `src/modules/compliance/__tests__/compliance.controller.test.ts` |

## Dependencies
- **Blocks:** S-IA-30-2, S-IA-30-3, S-IA-31-1
- **Blocked by:** S-IA-15-2 (framework linking for ILO-to-element mapping), S-IA-14-1 (ILOs exist)
- **Cross-epic:** Reads curriculum graph built by E-09, E-14, E-15

## Notes
- Neo4j Cypher: MATCH chain=(e:LCME_Element)<-[:MAPS_TO]-(ilo:ILO)<-[:ALIGNS_WITH]-(slo:SLO)<-[:OFFERS]-(c:Course) WHERE e.standard_id = $standardId RETURN chain.
- LCME standards use SCREAMING_SNAKE_CASE labels in Neo4j (LCME_Element, LCME_Standard).
- Seed data includes all 12 LCME standards with their elements from the LCME specification.
- Cache invalidation via event: when any ILO/SLO/Course mapping changes, mark cache stale.
- 5-minute performance target requires efficient Cypher queries and possible pre-materialization.
