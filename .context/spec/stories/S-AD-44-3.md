# S-AD-44-3: Root-Cause Tracing

**Epic:** E-44 (Risk Prediction Engine)
**Feature:** F-21
**Sprint:** 37
**Lane:** advisor (P5)
**Size:** M

## User Story
As a **system**, I need to traverse the prerequisite graph to identify root-cause concepts behind a student's struggles so that advisors can recommend targeted remediation.

## Acceptance Criteria
- [ ] Given a struggling concept, traverse prerequisite chain to find unmastered prerequisites
- [ ] Neo4j Cypher query: follow (Concept)-[:PREREQUISITE_OF]->(Concept) relationships
- [ ] Depth limit: 5 levels to prevent unbounded traversal
- [ ] Root cause = deepest unmastered concept in the prerequisite chain
- [ ] Support multiple struggling concepts: return unified root-cause set
- [ ] Output: ordered list of root causes ranked by impact (number of downstream concepts affected)
- [ ] Impact score: count of downstream concepts blocked by this root cause
- [ ] API endpoint: GET /api/risk/root-cause/:studentId
- [ ] Visualization data: return chain paths for UI rendering
- [ ] Cache results with 1-hour TTL (root causes don't change rapidly)

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/python-api | `src/models/root_cause_types.py` |
| Algorithm | packages/python-api | `src/algorithms/root_cause_tracer.py` |
| Service | packages/python-api | `src/services/root_cause_service.py` |
| Route | packages/python-api | `src/routes/root_cause.py` |
| Tests | packages/python-api | `tests/test_root_cause_tracer.py` |
| Tests | packages/python-api | `tests/test_root_cause_service.py` |

## Dependencies
- **Blocks:** S-AD-45-2 (intervention recommendations need root causes)
- **Blocked by:** S-AD-44-1 (risk model identifies struggling concepts), S-ST-40-3 (mastery data)
- **Cross-epic:** Reuses prerequisite graph from curriculum mapping (E-09)

## Notes
- Neo4j Cypher: MATCH path=(root:Concept)-[:PREREQUISITE_OF*1..5]->(target) WHERE target.id IN $strugglingConcepts AND NOT root.mastered RETURN path.
- Join mastery data from BKT: filter traversal results by student's mastery state.
- Root cause may be a foundational science concept (e.g., cell biology) affecting multiple clinical topics.
- Cache in Redis or in-memory with TTL; root causes shift slowly as mastery changes.
