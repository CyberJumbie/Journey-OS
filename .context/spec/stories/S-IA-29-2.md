# S-IA-29-2: Gap-to-Workbench Handoff

**Epic:** E-29 (Gap-Driven Generation)
**Feature:** F-13
**Sprint:** 8
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **Institutional Admin**, I need the "Generate for gap" action to launch the workbench pre-configured with the gap scope so that faculty can immediately start generating questions for under-assessed areas without manual configuration.

## Acceptance Criteria
- [ ] "Generate for gap" button in drill-down UI constructs a `GenerationSpec` with pre-filled scope (system, discipline, topic, SubConcepts)
- [ ] Navigation to workbench with spec passed via URL search params and/or session storage
- [ ] Workbench generation wizard auto-fills: scope step pre-populated, difficulty defaults to Medium
- [ ] Post-generation coverage delta shown: "Before: 23% → After: 31% (+8%)" for the targeted cell
- [ ] Coverage delta computed by re-querying coverage service after new questions saved
- [ ] Faculty notification: if admin initiates gap generation, assigned faculty receives a notification
- [ ] 8-10 API tests: spec construction, navigation params, wizard pre-fill, coverage delta computation, notification dispatch
- [ ] Named exports only, TypeScript strict

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/coverage/gap-handoff.types.ts` |
| Service | apps/server | `src/services/coverage/gap-handoff.service.ts` |
| Controller | apps/server | `src/controllers/coverage.controller.ts` (update) |
| Organisms | apps/web | `src/components/coverage/gap-generate-button.tsx`, `src/components/coverage/coverage-delta-card.tsx` |
| Hooks | apps/web | `src/hooks/use-gap-handoff.ts` |
| Tests | apps/server | `src/tests/coverage/gap-handoff.test.ts` |
| Tests | apps/web | `src/tests/coverage/gap-generate-button.test.tsx` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-IA-29-1 (drill-down UI), S-F-19-1 (workbench exists to navigate to)
- **Cross-epic:** S-F-19-1 (Sprint 7 workbench), S-F-19-4 (generation wizard to pre-fill)

## Notes
- Handoff URL format: `/workbench?mode=generate&prefill=gap&system=cardiovascular&discipline=pathology&topic=myocardial_infarction`
- Session storage fallback: store full `GenerationSpec` object in sessionStorage keyed by a handoff ID
- Coverage delta requires two snapshots: one before generation, one after — use `CoverageComputationService.computeForCell(system, discipline)`
- Notification uses the notification system from E-34 (if available) or falls back to in-app toast
- Role check: only institutional_admin and course_director can initiate gap-driven generation for other faculty
