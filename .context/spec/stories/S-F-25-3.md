# S-F-25-3: Export Service

**Epic:** E-25 (Item Bank Browser & Export)
**Feature:** F-11
**Sprint:** 18
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need to export selected questions in ExamSoft format so that I can import them into our institution's exam delivery platform.

## Acceptance Criteria
- [ ] Export accepts array of question IDs or current filter criteria
- [ ] ExamSoft format: generates compatible import file (CSV with specific column structure)
- [ ] QTI 2.1 export: alternative format for LMS compatibility
- [ ] CSV export: flat format with all metadata fields
- [ ] Export includes: stem, vignette, answer choices, correct answer, rationale, tags, difficulty, Bloom level
- [ ] Batch export: handles up to 500 items per export
- [ ] Download as file: generates file and returns download URL
- [ ] Export job for large batches: async with progress notification
- [ ] Custom error class: `ExportError`, `ExportFormatError`
- [ ] 8-12 API tests: each format, field mapping, batch size, large export async, download URL
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/item-bank/export.types.ts` |
| Service | apps/server | `src/services/item-bank/export.service.ts`, `src/services/item-bank/formatters/examsoft-formatter.ts`, `src/services/item-bank/formatters/qti-formatter.ts`, `src/services/item-bank/formatters/csv-formatter.ts` |
| Controller | apps/server | `src/controllers/item-bank/export.controller.ts` |
| Errors | apps/server | `src/errors/export.errors.ts` |
| Tests | apps/server | `src/tests/item-bank/export.test.ts`, `src/tests/item-bank/formatters.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-F-25-1 (item bank browser exists for selection)
- **Cross-epic:** none

## Notes
- ExamSoft format specifics: tab-delimited with specific column order and encoding requirements
- QTI 2.1 XML: use XML builder library, validate against QTI schema
- Export file stored in Supabase Storage temp bucket with 24h TTL
- Large export (>100 items): Inngest async function with completion notification
- Consider export history page for re-downloading past exports
- Formatter pattern: strategy pattern with `ExportFormatter` interface, concrete implementations per format
