# S-IA-17-2: Hierarchy Tree View

**Epic:** E-17 (Framework Browser UI)
**Feature:** F-08
**Sprint:** 3
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **Institutional Admin**, I need an expandable tree browser for each framework so that I can explore the hierarchical structure of standards, competencies, and objectives.

## Acceptance Criteria
- [ ] Tree view page at /institution/frameworks/[frameworkId]
- [ ] Root nodes loaded on page load; children loaded on expand (lazy loading)
- [ ] Each tree node shows: name, ID, level indicator, child count badge
- [ ] Expand/collapse toggle with smooth animation
- [ ] Click node to see detail panel: full description, relationships, metadata
- [ ] Breadcrumb navigation showing current path in hierarchy
- [ ] Neo4j query follows relationships: (Parent)-[:CONTAINS|HAS_ELEMENT]->(Child)
- [ ] Tree supports variable depth: 4 levels (USMLE) down to 1 level (Bloom, Miller)
- [ ] Loading indicator on expand for deeper levels
- [ ] 8 API tests: root nodes query, children query, node detail, empty children, auth enforcement, framework not found, relationship traversal, lazy loading pagination

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | src/frameworks/framework-tree.types.ts |
| Service | apps/server | src/services/framework/framework-tree.service.ts |
| Controller | apps/server | src/controllers/framework/framework-tree.controller.ts |
| View | apps/web | src/app/(protected)/institution/frameworks/[frameworkId]/page.tsx |
| Components | packages/ui | src/components/trees/framework-tree.tsx, src/components/trees/tree-node.tsx, src/components/panels/node-detail-panel.tsx |
| Tests | apps/server | src/services/framework/__tests__/framework-tree.service.test.ts |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-IA-17-1
- **Cross-epic:** S-U-16-3 (USMLE hierarchy is the primary test case)

## Notes
- Lazy loading is essential: USMLE has 227 nodes, loading all at once is unnecessary.
- Neo4j query pattern: `MATCH (p {framework_id: $parentId})-[:CONTAINS|HAS_ELEMENT]->(c) RETURN c ORDER BY c.sort_order`.
- Tree component (organism) should be generic enough for reuse in curriculum mapping views.
- Detail panel slides in from the right (drawer pattern) on node click.
- Breadcrumb uses the path from root to current node, built from Neo4j shortest path query.
