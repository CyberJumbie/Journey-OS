# S-IA-36-2: Institution Overview Table

**Epic:** E-36 (Admin Dashboard & KPIs)
**Feature:** F-17
**Sprint:** 9
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **Institutional Admin**, I need an institution overview table showing status, user counts, and activity metrics so that I can monitor departmental and program health within my institution.

## Acceptance Criteria
- [ ] InstitutionOverviewTable: programs/departments within the institution as rows
- [ ] Columns: program name, status, faculty count, student count, course count, questions generated, last activity
- [ ] Sortable by any column, searchable by program name
- [ ] Row click expands inline detail: list of courses in that program with individual stats
- [ ] Summary row at bottom: institution totals
- [ ] Status indicators consistent with platform-wide design (Active/Draft/Archived)
- [ ] Export table as CSV
- [ ] Data fetched from `GET /api/admin/institution/overview`
- [ ] 8-10 API tests: table rendering, sorting, search, expand/collapse, summary totals, CSV export
- [ ] Named exports only, TypeScript strict, design tokens only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/admin/institution-overview.types.ts` |
| Service | apps/server | `src/services/admin/admin-dashboard.service.ts` (update) |
| Controller | apps/server | `src/controllers/admin/dashboard.controller.ts` (update) |
| Organisms | apps/web | `src/components/admin/institution-overview-table.tsx`, `src/components/admin/program-detail-row.tsx` |
| Utils | apps/web | `src/utils/csv-export.ts` |
| Hooks | apps/web | `src/hooks/use-institution-overview.ts` |
| Tests | apps/web | `src/tests/admin/institution-overview-table.test.tsx` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-IA-36-1 (admin dashboard page)
- **Cross-epic:** none

## Notes
- Table uses shadcn/ui `DataTable` with `@tanstack/react-table` — consistent with S-SA-05-1
- Expandable rows: use `react-table` row expansion API, render `ProgramDetailRow` inline
- Aggregation queries: `SELECT program_id, COUNT(DISTINCT user_id), COUNT(DISTINCT course_id), COUNT(DISTINCT question_id) FROM ... GROUP BY program_id`
- CSV export: generate on client side from current table data (including filters/sort applied)
- Scoped to current user's institution via auth context — no cross-institution data exposure
- Last activity: most recent `activity_events.created_at` per program
