# S-IA-31-3: Snapshot Comparison

**Epic:** E-31 (LCME Report Export)
**Feature:** F-14
**Sprint:** 39
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **institutional admin**, I need to compare two compliance snapshots side by side so that I can track compliance improvements and regressions over time.

## Acceptance Criteria
- [ ] Snapshot selector: pick two snapshots from dropdown (date-labeled)
- [ ] Side-by-side comparison: standard/element compliance scores
- [ ] Diff highlighting: improved (green arrow up), regressed (red arrow down), unchanged (gray)
- [ ] Delta values: "+5%" or "-3%" per element
- [ ] Summary statistics: total improvements, total regressions, net change
- [ ] New/removed elements highlighted (if standards changed between snapshots)
- [ ] Comparison view at `/admin/compliance/compare?a={id1}&b={id2}`
- [ ] API endpoint: GET /api/compliance/snapshots/compare?a={id1}&b={id2}
- [ ] Export comparison as PDF
- [ ] Responsive table layout with sticky headers

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/compliance/comparison.types.ts` |
| Service | apps/server | `src/modules/compliance/services/snapshot-comparison.service.ts` |
| Controller | apps/server | `src/modules/compliance/controllers/snapshot.controller.ts` (extend) |
| Route | apps/server | `src/modules/compliance/routes/snapshot.routes.ts` (extend) |
| View | apps/web | `src/app/(dashboard)/admin/compliance/compare/page.tsx` |
| Component | apps/web | `src/components/compliance/snapshot-comparison-table.tsx` |
| Component | apps/web | `src/components/compliance/delta-indicator.tsx` |
| Component | apps/web | `src/components/compliance/snapshot-selector.tsx` |
| API Tests | apps/server | `src/modules/compliance/__tests__/snapshot-comparison.service.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-IA-31-1 (at least two snapshots needed for comparison)
- **Cross-epic:** none

## Notes
- Comparison algorithm: iterate both snapshot JSON structures, compute per-element deltas.
- Handle schema evolution: if LCME standards change between snapshots, mark added/removed elements.
- Delta indicator is a reusable atom component (arrow + percentage).
- Comparison PDF reuses PDF export service with comparison-specific template.
- This feature is critical for demonstrating continuous improvement to LCME reviewers.
