# S-F-35-3: Session Broadcast

**Epic:** E-35 (Real-time Collaboration)
**Feature:** F-16
**Sprint:** 19
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need generation events broadcast to all room members so that observers can watch a colleague's generation session in real time.

## Acceptance Criteria
- [ ] Generation pipeline events broadcast to session room members
- [ ] Events: `generation:started`, `generation:node.complete`, `generation:streaming`, `generation:complete`, `generation:error`
- [ ] Observer mode: non-owner room members see read-only live view of generation progress
- [ ] Event payload: node name, progress percentage, partial output (for streaming), timestamps
- [ ] Owner indicator: visual distinction between session owner and observers
- [ ] Broadcast throttling: streaming events throttled to 100ms intervals to prevent flooding
- [ ] Late join: observers joining mid-session receive current state snapshot
- [ ] Custom error class: `BroadcastError`
- [ ] 8-12 API tests: event broadcast, observer receipt, throttling, late join state, owner identification
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/collaboration/broadcast.types.ts` |
| Service | apps/server | `src/services/collaboration/session-broadcast.service.ts` |
| Hooks | apps/web | `src/hooks/useSessionBroadcast.ts` |
| View | apps/web | `src/components/collaboration/ObserverBanner.tsx` |
| Tests | apps/server | `src/tests/collaboration/session-broadcast.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-F-35-1 (room management exists)
- **Cross-epic:** S-F-18-1 (generation pipeline emits events to broadcast)

## Notes
- Broadcast service wraps Socket.io room emit — generation pipeline calls broadcast on each node transition
- Observer mode: same workbench UI but all controls disabled, "Observing [user]'s session" banner
- Late join state snapshot: current pipeline state (which node, progress, partial outputs) sent on room join
- Throttling uses lodash `throttle` or custom interval-based buffer for streaming events
- Socket.io broadcast uses `socket.to(roomId).emit()` — excludes sender
- Consider "Request control" feature for future collaboration enhancement (not in scope)
- This is Socket.io only — SSE is for direct session owner's progress stream
