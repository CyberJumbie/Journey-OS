# S-IA-36-4: Sync Status Monitor

**Epic:** E-36 (Admin Dashboard & KPIs)
**Feature:** F-17
**Sprint:** 9
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **Institutional Admin**, I need a sync status monitor showing dual-write health across all tables so that I can detect and investigate data consistency issues between Supabase and Neo4j.

## Acceptance Criteria
- [ ] SyncMonitorPage: table of all dual-written entity types with sync health per type
- [ ] Columns: entity type, total records, synced count, pending count, failed count, sync health (%)
- [ ] Color-coded health: green (>99%), yellow (95-99%), red (<95%)
- [ ] Failed records expandable: shows individual records with failure reason and retry button
- [ ] Manual retry: trigger re-sync for individual failed records or bulk retry all failures
- [ ] Sync history chart: sync health trend over last 7 days (line chart)
- [ ] Auto-refresh every 30 seconds
- [ ] Data fetched from `GET /api/admin/sync/status` and `GET /api/admin/sync/failures`
- [ ] SyncMonitorService queries `sync_status` column across dual-written tables
- [ ] 8-10 API tests: status display, failure list, retry mechanism, health calculation, trend data
- [ ] Named exports only, TypeScript strict, design tokens only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/admin/sync-monitor.types.ts` |
| Service | apps/server | `src/services/admin/sync-monitor.service.ts` |
| Controller | apps/server | `src/controllers/admin/sync-monitor.controller.ts` |
| Organisms | apps/web | `src/components/admin/sync-status-table.tsx`, `src/components/admin/sync-failure-list.tsx`, `src/components/admin/sync-history-chart.tsx` |
| Pages | apps/web | `src/app/(institutional-admin)/admin/sync-monitor/page.tsx` |
| Hooks | apps/web | `src/hooks/use-sync-monitor.ts` |
| Tests | apps/server | `src/tests/admin/sync-monitor.test.ts` |
| Tests | apps/web | `src/tests/admin/sync-status-table.test.tsx` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-IA-36-1 (admin dashboard page)
- **Cross-epic:** none

## Notes
- Dual-written tables: `institutions`, `users`, `courses`, `programs`, `slos`, `ilos`, `concepts`, `questions` — all have `sync_status` column
- Sync status values: `synced`, `pending`, `failed`, `retrying`
- Health query per table: `SELECT sync_status, COUNT(*) FROM {table} WHERE institution_id = $id GROUP BY sync_status`
- Retry mechanism: calls `DualWriteService.retrySync(entityType, entityId)` which re-attempts the Neo4j write
- Bulk retry: `POST /api/admin/sync/retry-all` — processes up to 100 failed records per call
- Sync history: stored in `sync_health_snapshots` table, one row per entity type per day
- Chart uses `recharts` (consistent with S-SA-05-2 institution detail charts)
- Auto-refresh: `useInterval` with 30s polling, pause on tab hidden
