# S-F-21-4: Auto-Tagging Service

**Epic:** E-21 (Validation & Dedup Engine)
**Feature:** F-10
**Sprint:** 12
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need questions to be automatically tagged with framework mappings, Bloom's taxonomy level, and difficulty so that items are categorized consistently without manual effort.

## Acceptance Criteria
- [ ] Auto-tag assigns USMLE system, discipline, and competency framework tags
- [ ] Bloom's taxonomy level derived from stem verb analysis + LLM classification
- [ ] Difficulty assignment: easy/medium/hard based on concept depth, distractor quality, clinical reasoning level
- [ ] Tags written to both Supabase (question metadata) and Neo4j (relationship edges)
- [ ] DualWriteService pattern: Supabase first → Neo4j second → sync_status
- [ ] Tagging runs after validation + dedup pass
- [ ] Tag confidence score included (0-1 float) for each assigned tag
- [ ] Override capability: faculty can manually adjust auto-assigned tags
- [ ] Custom error class: `TaggingServiceError`
- [ ] 10-14 API tests: framework tagging, Bloom assignment, difficulty rating, dual-write sync, confidence scores, manual override
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/validation/tagging.types.ts` |
| Repository | apps/server | `src/repositories/question-tag.repository.ts` |
| Service | apps/server | `src/services/validation/auto-tagging.service.ts`, `src/services/validation/bloom-classifier.service.ts` |
| Errors | apps/server | `src/errors/tagging.errors.ts` |
| Tests | apps/server | `src/tests/validation/auto-tagging.test.ts`, `src/tests/validation/bloom-classifier.test.ts` |

## Dependencies
- **Blocks:** S-F-24-3, S-F-25-1
- **Blocked by:** S-F-21-1 (validation engine exists)
- **Cross-epic:** S-F-24-3 (Sprint 17 import pipeline), S-F-25-1 (Sprint 18 item bank)

## Notes
- Bloom verb mapping: Remember (define, list), Understand (explain, describe), Apply (calculate, demonstrate), Analyze (differentiate, compare), Evaluate (critique, justify), Create (design, construct)
- Framework tags use SCREAMING_SNAKE_CASE Neo4j labels (e.g., `USMLE_System`)
- Difficulty heuristic considers: number of reasoning steps, clinical vs. basic science, distractor similarity to correct answer
- Neo4j relationships: `(Question)-[:TAGGED_WITH]->(FrameworkNode)`, `(Question)-[:AT_BLOOM_LEVEL]->(BloomLevel)`
- Tag confidence < 0.7 should add `low_confidence_tag` warning for reviewer attention
