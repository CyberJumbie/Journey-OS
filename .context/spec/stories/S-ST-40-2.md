# S-ST-40-2: IRT 3PL Calibration

**Epic:** E-40 (BKT & IRT Engine)
**Feature:** F-19
**Sprint:** 31
**Lane:** student (P4)
**Size:** L

## User Story
As a **system**, I need to estimate IRT 3-parameter logistic (3PL) item parameters from historical response data so that item difficulty, discrimination, and guessing are calibrated for adaptive testing.

## Acceptance Criteria
- [ ] 3PL model implementation: difficulty (b), discrimination (a), guessing (c) parameters
- [ ] Calibration algorithm: marginal maximum likelihood estimation (MMLE) via EM algorithm
- [ ] Input: item response matrix (student x item binary matrix)
- [ ] Output: calibrated parameters per item with standard errors
- [ ] Minimum response threshold: 100 responses per item before calibration
- [ ] Convergence criteria: parameter change < 0.001 or max 100 iterations
- [ ] Item fit statistics: infit, outfit MNSQ for quality assessment
- [ ] Flag poorly-fitting items (MNSQ outside 0.7-1.3 range)
- [ ] Batch calibration endpoint: POST /api/irt/calibrate
- [ ] Store calibrated parameters in Supabase with timestamp
- [ ] Recalibration scheduling via Inngest (weekly or on-demand)
- [ ] Performance: calibrate 1000 items x 500 students in < 60 seconds

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/python-api | `src/models/irt_types.py` |
| Algorithm | packages/python-api | `src/algorithms/irt_3pl.py` |
| Algorithm | packages/python-api | `src/algorithms/irt_calibration.py` |
| Service | packages/python-api | `src/services/irt_calibration_service.py` |
| Repository | packages/python-api | `src/repositories/item_parameter_repository.py` |
| Route | packages/python-api | `src/routes/irt.py` |
| Job | packages/python-api | `src/jobs/calibration_job.py` |
| Tests | packages/python-api | `tests/test_irt_3pl.py` |
| Tests | packages/python-api | `tests/test_irt_calibration_service.py` |
| Tests | packages/python-api | `tests/test_item_fit.py` |

## Dependencies
- **Blocks:** S-ST-40-4 (item selection needs calibrated parameters)
- **Blocked by:** S-ST-40-1 (FastAPI scaffold), S-F-27-3 (retired exam data for calibration)
- **Cross-epic:** Item parameters used by S-ST-42-3 (readiness calculation refinement)

## Notes
- Use numpy/scipy for numerical computation; avoid PyTorch for this (not neural).
- MMLE-EM is the standard approach; consider py-irt or custom implementation.
- Item bank requirement: >= 500 calibrated items before adaptive testing activates.
- 3PL guessing parameter (c) typically constrained to [0, 0.35] for MCQs.
- All embeddings unrelated here; IRT is classical psychometrics, not embedding-based.
