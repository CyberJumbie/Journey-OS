# S-IA-06-3: User Deactivation

**Epic:** E-06 (Per-Institution User Management)
**Feature:** F-03
**Sprint:** 3
**Lane:** institutional_admin (P2)
**Size:** S

## User Story
As an **Institutional Admin**, I need to deactivate a user so that their access is revoked while preserving their data for audit and potential reactivation.

## Acceptance Criteria
- [ ] Deactivate button on user detail view with confirmation dialog
- [ ] Confirmation dialog shows: user name, role, and impact summary
- [ ] Soft-delete: sets status='deactivated', does not remove records
- [ ] Deactivated users cannot log in (Supabase user disabled)
- [ ] Deactivated users appear in list with 'deactivated' status badge
- [ ] DualWriteService updates both Supabase and Neo4j status
- [ ] Reactivation option available (reverses deactivation)
- [ ] Audit log entry for deactivation: who, when, reason
- [ ] 5 API tests: deactivation, login prevention, reactivation, auth enforcement, audit log

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Service | apps/server | src/services/user/user-deactivation.service.ts |
| Controller | apps/server | src/controllers/user/user-deactivation.controller.ts |
| Components | packages/ui | src/components/modals/deactivation-confirm-modal.tsx |
| Tests | apps/server | src/services/user/__tests__/user-deactivation.service.test.ts |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-IA-06-1
- **Cross-epic:** none

## Notes
- Soft-delete pattern: never hard-delete user records. Set status field and disable Supabase auth user.
- Supabase admin API: `supabase.auth.admin.updateUserById(id, { banned: true })` for deactivation.
- Reactivation reverses the ban and sets status='active'.
- Consider cascade effects: deactivated faculty should not appear in course assignment dropdowns.
