# S-F-24-1: Import Parser

**Epic:** E-24 (Legacy Import Pipeline)
**Feature:** F-11
**Sprint:** 17
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need parsers for CSV, QTI, and plain text formats so that I can import legacy question banks from existing systems into Journey OS.

## Acceptance Criteria
- [ ] CSV parser: handles standard CSV with configurable column mapping
- [ ] QTI parser: supports QTI 2.1 XML format (common in LMS exports)
- [ ] Plain text parser: regex-based extraction from formatted text (stem, choices, answer key)
- [ ] Parser factory: auto-detect format from file extension and content sniffing
- [ ] Each parser returns standardized `ParsedQuestion[]` with normalized fields
- [ ] Validation: parser-level validation for malformed input (missing stem, no correct answer, etc.)
- [ ] Error collection: non-fatal parse errors collected per row/item with line number
- [ ] File size limit: configurable max (default 10MB)
- [ ] Custom error classes: `ParseError`, `UnsupportedFormatError`, `FileSizeLimitError`
- [ ] 10-14 API tests: each format, auto-detection, malformed input, partial parse, size limit
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/import/parser.types.ts`, `src/import/parsed-question.types.ts` |
| Service | apps/server | `src/services/import/parser-factory.service.ts`, `src/services/import/parsers/csv-parser.ts`, `src/services/import/parsers/qti-parser.ts`, `src/services/import/parsers/text-parser.ts` |
| Errors | apps/server | `src/errors/import.errors.ts` |
| Tests | apps/server | `src/tests/import/csv-parser.test.ts`, `src/tests/import/qti-parser.test.ts`, `src/tests/import/text-parser.test.ts`, `src/tests/import/parser-factory.test.ts` |

## Dependencies
- **Blocks:** S-F-24-2, S-F-24-3
- **Blocked by:** none
- **Cross-epic:** none

## Notes
- QTI 2.1 is XML-based; use `fast-xml-parser` for efficient parsing
- CSV parsing: use `papaparse` with header detection and type inference
- Plain text parser: support common formats like "1. Stem\nA) Choice\nB) Choice\n*C) Correct\nD) Choice"
- Parser output is format-agnostic `ParsedQuestion` — downstream pipeline doesn't care about source format
- Consider streaming parser for large files to avoid memory spikes
- File upload handled by Supabase Storage (E-10) — parsers receive file buffer/stream
