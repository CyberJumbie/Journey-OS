# S-F-34-3: Inngest Notification Triggers

**Epic:** E-34 (Notification System)
**Feature:** F-16
**Sprint:** 19
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need automatic notifications triggered by system events so that I am informed when batches complete, reviews are requested, and gap scans find issues.

## Acceptance Criteria
- [ ] Trigger on `batch.complete`: notify batch owner with success/failure summary
- [ ] Trigger on `review.request`: notify assigned reviewer (or all eligible reviewers)
- [ ] Trigger on `review.decision`: notify question generator of approve/reject/revise decision
- [ ] Trigger on `gap.scan.complete`: notify course owner when coverage gaps detected
- [ ] Trigger on `kaizen.drift.detected`: notify institutional admins of quality drift
- [ ] Trigger on `kaizen.lint.complete`: notify admins if critical findings > 0
- [ ] Each trigger creates notification via NotificationService (persists + pushes)
- [ ] Trigger functions are idempotent (safe to replay)
- [ ] Custom error class: `NotificationTriggerError`
- [ ] 8-12 API tests: each trigger event, notification content, recipient resolution, idempotency
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/notification/trigger.types.ts` |
| Service | apps/server | `src/services/notification/trigger-resolver.service.ts` |
| Inngest | apps/server | `src/inngest/functions/notify-batch-complete.fn.ts`, `src/inngest/functions/notify-review-request.fn.ts`, `src/inngest/functions/notify-review-decision.fn.ts`, `src/inngest/functions/notify-gap-scan.fn.ts`, `src/inngest/functions/notify-kaizen.fn.ts` |
| Tests | apps/server | `src/tests/notification/triggers.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-F-34-2 (notification service exists to push through)
- **Cross-epic:** S-F-20-1 (batch events), S-F-22-2 (review events), S-IA-37-1 (kaizen events)

## Notes
- Inngest functions listen for existing events emitted by other services — no new event emission needed
- Recipient resolution: TriggerResolverService maps event to target user(s) based on context
- `review.request` may notify multiple eligible reviewers — use bulk notification creation
- Idempotency: use event ID as dedup key in notification creation
- Notification content templates: structured message builders per trigger type
- Consider notification batching: if 10 items complete in quick succession, send 1 summary notification
