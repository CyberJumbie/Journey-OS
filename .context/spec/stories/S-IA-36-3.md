# S-IA-36-3: Knowledge Graph Browser

**Epic:** E-36 (Admin Dashboard & KPIs)
**Feature:** F-17
**Sprint:** 9
**Lane:** institutional_admin (P2)
**Size:** L

## User Story
As an **Institutional Admin**, I need a knowledge graph browser to explore nodes and relationships directly so that I can understand the curriculum data structure, verify data integrity, and investigate unexpected linkages.

## Acceptance Criteria
- [ ] GraphBrowser page: search bar + graph canvas + detail sidebar
- [ ] Search: find nodes by label, name, or property value (typeahead autocomplete)
- [ ] Supported node types: Course, SLO, ILO, Concept, SubConcept, USMLE_Topic, USMLE_System, USMLE_Discipline, Question
- [ ] Node rendering: different shapes/colors per label (circles for concepts, squares for courses, etc.)
- [ ] Relationship rendering: labeled directed edges with relationship type visible on hover
- [ ] Expand/collapse: click a node to load its neighbors (lazy loading, not full graph)
- [ ] Detail sidebar: shows all properties of selected node/relationship
- [ ] Path finder: select two nodes and show shortest path between them
- [ ] Max visible nodes: 200 (with "load more neighbors" prompt)
- [ ] Filter by node type and relationship type
- [ ] 12-15 API tests: search, node rendering, expand, detail display, path finding, filtering, performance
- [ ] Named exports only, TypeScript strict, design tokens only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/admin/graph-browser.types.ts` |
| Service | apps/server | `src/services/admin/graph-browser.service.ts` |
| Repository | apps/server | `src/repositories/graph-browser.repository.ts` |
| Controller | apps/server | `src/controllers/admin/graph-browser.controller.ts` |
| Atoms | packages/ui | `src/atoms/graph-search-input.tsx` |
| Molecules | packages/ui | `src/molecules/node-detail-sidebar.tsx`, `src/molecules/graph-filter-panel.tsx` |
| Organisms | apps/web | `src/components/admin/graph-browser.tsx`, `src/components/admin/graph-canvas.tsx` |
| Pages | apps/web | `src/app/(institutional-admin)/admin/graph-browser/page.tsx` |
| Hooks | apps/web | `src/hooks/use-graph-browser.ts`, `src/hooks/use-graph-search.ts` |
| Tests | apps/server | `src/tests/admin/graph-browser.test.ts` |
| Tests | apps/web | `src/tests/admin/graph-browser-page.test.tsx` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-U-16-4 (frameworks seeded — graph has data to browse)
- **Cross-epic:** S-U-16-4 (Sprint 5 framework seeding)

## Notes
- Neo4j queries for neighbors: `MATCH (n)-[r]-(m) WHERE id(n) = $nodeId RETURN n, r, m LIMIT 50`
- Path finder: `MATCH path = shortestPath((a)-[*..10]-(b)) WHERE id(a) = $startId AND id(b) = $endId RETURN path`
- Search: `MATCH (n) WHERE n.name =~ '(?i).*' + $query + '.*' RETURN n LIMIT 20` with label filter
- Graph canvas uses D3 force simulation (reuses patterns from S-IA-28-3 concept graph)
- Lazy loading: only fetch immediate neighbors on expand, not full subgraph
- Node shapes: use D3 symbol generators — circle (Concept), square (Course), diamond (SLO), triangle (Question)
- Detail sidebar: JSON-like property display with copy-to-clipboard for IDs
- Scoped to institution: all queries include institution_id filter where applicable
