# S-F-35-1: Socket.io Room Management

**Epic:** E-35 (Real-time Collaboration)
**Feature:** F-16
**Sprint:** 19
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need to join and leave Socket.io session rooms so that I can collaborate with colleagues who are viewing the same generation session or review in real time.

## Acceptance Criteria
- [ ] Room creation: auto-create room when first user joins a session/page context
- [ ] Room naming convention: `session:{sessionId}`, `review:{questionId}`, `batch:{batchId}`
- [ ] Join room: user added to room on page navigation (automatic)
- [ ] Leave room: user removed on page navigation away or disconnect
- [ ] Room member list: query current members of a room
- [ ] Room events: `room:joined`, `room:left` emitted to all room members
- [ ] Max room size: configurable limit (default 20) to prevent resource issues
- [ ] Room cleanup: empty rooms garbage-collected after TTL (5 minutes)
- [ ] Custom error class: `RoomManagementError`
- [ ] 8-12 API tests: join/leave, member list, events, max size, cleanup
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/collaboration/room.types.ts` |
| Service | apps/server | `src/services/collaboration/room-manager.service.ts` |
| Middleware | apps/server | `src/middleware/socket-room.middleware.ts` |
| Hooks | apps/web | `src/hooks/useRoom.ts` |
| Tests | apps/server | `src/tests/collaboration/room-manager.test.ts` |

## Dependencies
- **Blocks:** S-F-35-2, S-F-35-3
- **Blocked by:** S-F-34-2 (Socket.io infrastructure exists)
- **Cross-epic:** S-F-34-2 (Sprint 19 Socket.io service)

## Notes
- Room management builds on Socket.io infrastructure from E-34 â€” shares the same server instance
- Socket.io native rooms used (no custom room implementation needed)
- Auto-join: React hook `useRoom(roomId)` joins on mount, leaves on unmount
- Room member tracking: in-memory Map of roomId -> Set of { userId, socketId, joinedAt }
- Consider room locking: prevent new joins during critical operations (e.g., batch export)
- Reconnection: user re-joins room automatically on Socket.io reconnect via middleware
