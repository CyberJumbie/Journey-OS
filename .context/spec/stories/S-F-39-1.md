# S-F-39-1: Template Model & CRUD

**Epic:** E-39 (Templates & Help)
**Feature:** F-18
**Sprint:** 16
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need to create, edit, delete, and share generation templates so that I can save and reuse my preferred question generation configurations.

## Acceptance Criteria
- [ ] Template model: name, description, question_type, difficulty_distribution, bloom_levels, scope_config, prompt_overrides, metadata
- [ ] CRUD operations: create, read, update, delete with ownership checks
- [ ] Sharing: templates can be `private`, `shared_course`, `shared_institution`, `public`
- [ ] Duplicate template: copy an existing template as starting point
- [ ] Template versioning: edit creates new version, previous versions accessible
- [ ] DualWriteService: Supabase `templates` table + Neo4j `Template` node
- [ ] Ownership: creator is owner; shared templates are read-only to non-owners
- [ ] Custom error classes: `TemplateNotFoundError`, `TemplatePermissionError`
- [ ] 10-14 API tests: CRUD operations, sharing levels, ownership checks, versioning, dual-write
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/template/template.types.ts` |
| Model | apps/server | `src/models/template.model.ts` |
| Repository | apps/server | `src/repositories/template.repository.ts` |
| Service | apps/server | `src/services/template/template.service.ts` |
| Controller | apps/server | `src/controllers/template/template.controller.ts` |
| Errors | apps/server | `src/errors/template.errors.ts` |
| Tests | apps/server | `src/tests/template/template.service.test.ts`, `src/tests/template/template.controller.test.ts` |

## Dependencies
- **Blocks:** S-F-39-2, S-F-39-3
- **Blocked by:** none
- **Cross-epic:** none

## Notes
- Template config mirrors batch config shape (E-20) for seamless integration
- Neo4j relationships: `(User)-[:OWNS]->(Template)`, `(Template)-[:FOR_COURSE]->(Course)`
- Sharing levels use RBAC: `shared_course` checks course membership, `shared_institution` checks institution membership
- Version history stored as JSONB array in Supabase or separate `template_versions` table
- Consider template categories/tags for organization (e.g., "midterm", "board prep", "formative")
