# S-IA-29-3: Gap Alert Service

**Epic:** E-29 (Gap-Driven Generation)
**Feature:** F-13
**Sprint:** 8
**Lane:** institutional_admin (P2)
**Size:** S

## User Story
As an **Institutional Admin**, I need automatic alerts when new coverage gaps are detected so that I can proactively address curriculum blind spots before they accumulate.

## Acceptance Criteria
- [ ] GapAlertService listens for `coverage.gaps.detected` Inngest events from nightly job
- [ ] Creates in-app notifications for institutional admins of affected institution
- [ ] Alert content: system, discipline, number of new gaps, link to heatmap drill-down
- [ ] Alert severity levels: info (1-2 new gaps), warning (3-5), critical (6+)
- [ ] Alerts visible on faculty dashboard (S-F-32-1 activity feed) and admin dashboard (S-IA-36-1)
- [ ] Alert deduplication: don't re-alert for gaps already flagged and not yet resolved
- [ ] 5-8 API tests: event consumption, notification creation, severity classification, deduplication, alert content
- [ ] Named exports only, TypeScript strict

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/coverage/alerts.types.ts` |
| Service | apps/server | `src/services/coverage/gap-alert.service.ts` |
| Repository | apps/server | `src/repositories/notification.repository.ts` (update or create) |
| Tests | apps/server | `src/tests/coverage/gap-alert.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-IA-28-4 (nightly job emits gap events)
- **Cross-epic:** S-F-32-1 (faculty dashboard activity feed), S-IA-36-1 (admin dashboard)

## Notes
- Inngest event handler: `inngest.createFunction({id: 'gap-alert-handler'}, {event: 'coverage.gaps.detected'}, async ({event}) => {...})`
- Notification stored in Supabase `notifications` table: `{ id, user_id, type, severity, title, body, link, read, created_at }`
- Deduplication: check `notifications` table for existing unread gap alerts for same system-discipline before creating new one
- Link format: `/coverage/${system}/${discipline}` â€” deep link to drill-down page
- Future: email alerts via E-34 notification system; for now, in-app only
