# S-F-12-1: SubConcept Extraction Service

**Epic:** E-12 (AI Concept Extraction)
**Feature:** F-06
**Sprint:** 5
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need AI-extracted SubConcepts from my content chunks so that the system automatically identifies what medical concepts are taught in my materials.

## Acceptance Criteria
- [ ] SubConcept TypeScript types: id, name, description, source_chunk_id, content_id, course_id, status, confidence_score
- [ ] ExtractionService using Claude Haiku (claude-3-haiku) with structured output prompt
- [ ] Prompt engineering: extract medical SubConcepts with name, description, and confidence score
- [ ] Process chunks in batches (10 chunks per LLM call) for efficiency
- [ ] Rate limiting: respect Anthropic API rate limits with exponential backoff
- [ ] SubConcept nodes created in Supabase with extraction metadata
- [ ] 10-12 API tests covering extraction from various content types, prompt validation, batch processing, error handling

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/concept/subconcept.types.ts` |
| Model | apps/server | `src/models/subconcept.model.ts` |
| Service | apps/server | `src/services/extraction.service.ts` |
| Prompt | apps/server | `src/prompts/concept-extraction.prompt.ts` |
| Config | apps/server | `src/config/anthropic.config.ts` |
| Tests | apps/server | `src/tests/extraction.service.test.ts` |

## Dependencies
- **Blocks:** S-F-12-2, S-F-12-3, S-F-12-4, S-F-13-1
- **Blocked by:** S-F-11-1 (content chunks must exist), S-F-11-4 (chunks dual-written)
- **Cross-epic:** E-11 (content processing pipeline)

## Notes
- Claude Haiku chosen for cost efficiency on high-volume extraction tasks
- Structured output: prompt returns JSON array of `{ name, description, confidence }` objects
- Confidence threshold: only persist SubConcepts with confidence >= 0.7
- SubConcept status: `extracted` (initial), `enriched` (after LOD), `verified` (after faculty review)
- Neo4j label: `SubConcept` (PascalCase per convention)
- Store API key in environment variable ANTHROPIC_API_KEY
- Extraction is idempotent: re-extracting from the same chunk produces same SubConcepts (deduped in S-F-12-3)
