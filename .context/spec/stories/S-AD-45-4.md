# S-AD-45-4: Admin Cohort Analytics

**Epic:** E-45 (Advisor Cohort Dashboard & Interventions)
**Feature:** F-21
**Sprint:** 38
**Lane:** advisor (P5)
**Size:** M

## User Story
As an **institutional admin**, I need aggregate risk metrics and trend monitoring across cohorts so that I can assess the effectiveness of academic support programs and allocate resources appropriately.

## Acceptance Criteria
- [ ] Admin analytics page at `/dashboard/admin/cohort-analytics`
- [ ] Cohort risk distribution: pie chart of risk levels per cohort
- [ ] Risk trend over time: line chart showing risk level changes across weeks
- [ ] Intervention effectiveness metrics: % of students who improved after intervention
- [ ] Cohort comparison: side-by-side risk profiles across different cohorts
- [ ] Key metrics cards: total at-risk count, average resolution time, intervention rate
- [ ] Filter by cohort, time period, course
- [ ] Export data as CSV for institutional reporting
- [ ] Role guard: admin and superadmin only
- [ ] Loading skeletons and empty states

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/admin/cohort-analytics.types.ts` |
| Service | apps/server | `src/modules/admin/services/cohort-analytics.service.ts` |
| Controller | apps/server | `src/modules/admin/controllers/cohort-analytics.controller.ts` |
| Route | apps/server | `src/modules/admin/routes/cohort-analytics.routes.ts` |
| View | apps/web | `src/app/(dashboard)/admin/cohort-analytics/page.tsx` |
| Component | apps/web | `src/components/admin/cohort-risk-distribution.tsx` |
| Component | apps/web | `src/components/admin/risk-trend-chart.tsx` |
| Component | apps/web | `src/components/admin/intervention-effectiveness.tsx` |
| API Tests | apps/server | `src/modules/admin/__tests__/cohort-analytics.service.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-AD-44-4 (risk flags), S-AD-45-3 (intervention data for effectiveness)
- **Cross-epic:** none

## Notes
- Aggregate queries use Supabase SQL with GROUP BY cohort, risk_level, time_bucket.
- Intervention effectiveness: compare mastery trajectory before/after intervention date.
- This view serves UF-34 (Admin Cohort Analytics Monitoring).
- CSV export uses streaming response for large datasets.
