# S-F-35-2: Presence Indicators

**Epic:** E-35 (Real-time Collaboration)
**Feature:** F-16
**Sprint:** 19
**Lane:** faculty (P3)
**Size:** S

## User Story
As a **Faculty member**, I need avatar presence indicators showing who else is viewing the same page so that I am aware of collaborators and avoid conflicting actions.

## Acceptance Criteria
- [ ] Avatar stack: overlapping circular avatars of users in the current room
- [ ] Tooltip on hover: user name and time joined
- [ ] Max display: show first 3 avatars + "+N" overflow indicator
- [ ] Real-time updates: avatars appear/disappear as users join/leave
- [ ] Status dot: green (active), yellow (idle > 2 min), gray (reconnecting)
- [ ] Placement: top-right corner of page content area
- [ ] User avatar from Supabase profile or initials fallback
- [ ] 5-8 API tests: member list, status transitions, avatar data
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/collaboration/presence.types.ts` |
| View | apps/web | `src/components/collaboration/PresenceIndicator.tsx`, `src/components/collaboration/AvatarStack.tsx` |
| Hooks | apps/web | `src/hooks/usePresence.ts` |
| Tests | apps/server | `src/tests/collaboration/presence.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-F-35-1 (room management provides member list)
- **Cross-epic:** none

## Notes
- `usePresence` hook subscribes to room member changes via Socket.io `room:joined`/`room:left` events
- Idle detection: client-side activity tracker (mouse move, key press) â€” emits heartbeat every 30s
- If no heartbeat for 2 minutes, status changes to idle (server-side timeout)
- Avatar images loaded from Supabase Storage user profile bucket
- Initials fallback: first letter of first name + first letter of last name, random background color
- AvatarStack uses shadcn/ui Avatar component with negative margin overlap
- Design tokens for status dot colors and avatar sizes
