# S-F-25-4: Repository Statistics

**Epic:** E-25 (Item Bank Browser & Export)
**Feature:** F-11
**Sprint:** 18
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need an aggregate statistics dashboard for the item bank so that I can understand the composition, quality distribution, and coverage of my question repository.

## Acceptance Criteria
- [ ] Total item count by status (approved, draft, rejected, archived)
- [ ] Distribution charts: Bloom level, difficulty, question type, USMLE system
- [ ] Quality metrics: average composite score, score distribution histogram
- [ ] Coverage heatmap: SLO coverage by question count
- [ ] Trend charts: items added per week/month over time
- [ ] Course-scoped and institution-scoped views
- [ ] KPI cards: total items, average quality, coverage percentage, items this month
- [ ] Data refresh: cached aggregates with manual refresh button
- [ ] 8-12 API tests: each aggregate query, scope filtering, cache behavior
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/item-bank/statistics.types.ts` |
| Service | apps/server | `src/services/item-bank/statistics.service.ts` |
| Controller | apps/server | `src/controllers/item-bank/statistics.controller.ts` |
| View | apps/web | `src/app/(dashboard)/faculty/item-bank/statistics/page.tsx`, `src/components/item-bank/StatisticsKPICards.tsx`, `src/components/item-bank/DistributionCharts.tsx`, `src/components/item-bank/CoverageHeatmap.tsx` |
| Tests | apps/server | `src/tests/item-bank/statistics.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-F-25-1 (item bank has items to compute statistics on)
- **Cross-epic:** none

## Notes
- Aggregate queries can be expensive â€” cache results in Supabase `statistics_cache` table with TTL
- Charts built with recharts (shadcn/ui compatible)
- Coverage heatmap: matrix of SLOs vs. Bloom levels, cell color intensity = question count
- Course-scoped view is default for faculty; institution-scoped available for admin roles
- Consider materialized views in Supabase for frequently computed aggregates
- Refresh interval: auto-refresh every 5 minutes on the statistics page, manual refresh available
