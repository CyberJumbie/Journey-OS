# S-IA-09-1: SLO-to-ILO Linking

**Epic:** E-09 (Course SLO Linking & Scheduling)
**Feature:** F-04
**Sprint:** 4
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **Institutional Admin**, I need to link course SLOs to institutional ILOs via FULFILLS relationships with an approval gate so that curriculum alignment is tracked and verified.

## Acceptance Criteria
- [ ] FULFILLS relationship type defined in Neo4j between SLO and ILO nodes
- [ ] Service to create, read, delete FULFILLS proposals
- [ ] Proposal states: proposed, approved, rejected
- [ ] Approval gate: Course Director proposes, Institutional Admin approves/rejects
- [ ] Repository layer for FULFILLS relationship CRUD in Neo4j
- [ ] Supabase tracking table for FULFILLS with status and audit fields
- [ ] DualWriteService: relationship created in both stores
- [ ] Validation: SLO must belong to a course in the same institution as the ILO
- [ ] 10-12 API tests covering proposal creation, approval, rejection, validation errors, cross-institution block

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/objective/fulfills.types.ts` |
| Repository | apps/server | `src/repositories/fulfills.repository.ts` |
| Service | apps/server | `src/services/fulfills.service.ts` |
| Tests | apps/server | `src/tests/fulfills.service.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-F-08-1 (courses must exist), S-IA-14-2 (SLOs must exist)
- **Cross-epic:** S-IA-14-1 (ILOs from E-14), S-IA-14-2 (SLOs from E-14)

## Notes
- Neo4j relationship: `(SLO)-[:FULFILLS {status: 'proposed'|'approved'|'rejected'}]->(ILO)`
- ILO and SLO are separate node types per architecture rules -- never combine them
- Approval gate is a lightweight workflow: no multi-step chain, just propose + approve/reject
- Audit fields: proposed_by, proposed_at, reviewed_by, reviewed_at, review_note
- This story creates the backend; the UI for mapping is in E-15 (Sprint 5)
