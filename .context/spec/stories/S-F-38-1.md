# S-F-38-1: Profile Page

**Epic:** E-38 (Profile & Preferences)
**Feature:** F-18
**Sprint:** 19
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member**, I need a profile page to edit my name, email, and avatar so that my identity is accurately represented across the platform.

## Acceptance Criteria
- [ ] Profile form: display name, email (read-only if SSO), bio, department, title
- [ ] Avatar upload: image picker with crop/resize, upload to Supabase Storage
- [ ] Avatar constraints: max 2MB, JPEG/PNG/WebP, 256x256 output
- [ ] Save changes: updates Supabase auth metadata + profile table
- [ ] DualWriteService: profile changes sync to Neo4j `User` node
- [ ] Email change: triggers verification email flow (Supabase Auth)
- [ ] Form validation: display name required, bio max 500 chars
- [ ] Success/error toast notifications on save
- [ ] Custom error classes: `ProfileUpdateError`, `AvatarUploadError`
- [ ] 8-12 API tests: profile read, update, avatar upload, validation, dual-write sync
- [ ] TypeScript strict, named exports only

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/user/profile.types.ts` |
| Service | apps/server | `src/services/user/profile.service.ts` |
| Controller | apps/server | `src/controllers/user/profile.controller.ts` |
| Repository | apps/server | `src/repositories/user-profile.repository.ts` |
| View | apps/web | `src/app/(dashboard)/settings/profile/page.tsx`, `src/components/settings/ProfileForm.tsx`, `src/components/settings/AvatarUploader.tsx` |
| Errors | apps/server | `src/errors/profile.errors.ts` |
| Tests | apps/server | `src/tests/user/profile.test.ts` |

## Dependencies
- **Blocks:** S-F-38-2, S-F-38-3
- **Blocked by:** S-U-01-3 (auth), S-U-02-1 (user profiles exist)
- **Cross-epic:** S-U-01-3 (Sprint 1 auth), S-U-02-1 (Sprint 2 user profiles)

## Notes
- Avatar stored in Supabase Storage `avatars` bucket: `avatars/{userId}/profile.{ext}`
- Image processing: client-side crop with `react-image-crop`, resize on upload
- DualWriteService updates Neo4j `User` node properties (name, avatar_url)
- Email change only available for non-SSO users (SSO email managed by provider)
- Profile page URL: `/settings/profile` â€” shared route for all roles
- Consider skeleton loading state while profile data fetches
- Form managed with React Hook Form + Zod validation schema
