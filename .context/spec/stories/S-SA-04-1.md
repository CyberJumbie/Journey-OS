# S-SA-04-1: Waitlist Application Form

**Epic:** E-04 (Institution Lifecycle)
**Feature:** F-02
**Sprint:** 3
**Lane:** superadmin (P1)
**Size:** M

## User Story
As a **prospective institutional admin**, I need a public application form to submit my institution's details for platform access so that my school can join the Journey OS waitlist.

## Acceptance Criteria
- [ ] Public (unauthenticated) form at /apply
- [ ] Fields: institution name, type (MD/DO/combined), accreditation body, contact name, contact email, contact phone, student count, website URL, reason for interest
- [ ] Client-side validation: required fields, email format, URL format
- [ ] Server-side validation mirrors client-side + sanitization
- [ ] ApplicationService creates waitlist record with status = 'pending'
- [ ] DualWriteService: Supabase applications table first, Neo4j Application node second
- [ ] Confirmation page shown after successful submission
- [ ] Duplicate application detection: warn if email or institution name already pending
- [ ] Rate limiting: max 3 applications per IP per hour
- [ ] 10 API tests: valid submission, missing fields, duplicate detection, email format, URL format, rate limiting, sanitization, status default, dual-write verification, confirmation response

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | src/institution/application.types.ts |
| Model | apps/server | src/models/application.model.ts |
| Repository | apps/server | src/repositories/application.repository.ts |
| Service | apps/server | src/services/institution/application.service.ts |
| Controller | apps/server | src/controllers/institution/application.controller.ts |
| Routes | apps/server | src/routes/application.routes.ts |
| View | apps/web | src/app/(public)/apply/page.tsx |
| Components | packages/ui | src/components/forms/application-form.tsx |
| Tests | apps/server | src/controllers/institution/__tests__/application.controller.test.ts |

## Dependencies
- **Blocks:** S-SA-04-2
- **Blocked by:** S-U-01-3 (RBAC needed for admin routes, but this form is public -- only the API storage needs auth setup for dual-write config)
- **Cross-epic:** none

## Notes
- This is a PUBLIC route; no auth middleware required for the form submission endpoint.
- However, the applications table and review endpoints (S-SA-04-2) require SuperAdmin auth.
- DualWriteService pattern: Supabase first -> Neo4j second -> sync_status = 'synced'.
- Consider CAPTCHA for bot prevention on the public form (Tier 2+ enhancement).
