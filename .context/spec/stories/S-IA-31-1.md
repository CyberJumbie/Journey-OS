# S-IA-31-1: Report Snapshot Service

**Epic:** E-31 (LCME Report Export)
**Feature:** F-14
**Sprint:** 39
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **institutional admin**, I need to capture point-in-time compliance snapshots so that I can track compliance changes over time and prepare for LCME site visits.

## Acceptance Criteria
- [ ] Snapshot creation: captures current compliance state with timestamp
- [ ] Snapshot record: id, institution_id, created_at, created_by, compliance_data (JSON)
- [ ] Compliance data includes: all standards, elements, compliance scores, evidence chain summaries
- [ ] API endpoint: POST /api/compliance/snapshots (create), GET /api/compliance/snapshots (list)
- [ ] Snapshot detail: GET /api/compliance/snapshots/:id
- [ ] Snapshot immutable after creation (no edits)
- [ ] Storage in Supabase with JSONB column for compliance data
- [ ] Snapshot naming: auto-generated "YYYY-MM-DD HH:mm" with optional custom label
- [ ] Retention policy: keep snapshots for 7 years (LCME accreditation cycle)
- [ ] Maximum 100 snapshots per institution (soft limit with warning)

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/compliance/snapshot.types.ts` |
| Model | apps/server | `src/modules/compliance/models/compliance-snapshot.model.ts` |
| Repository | apps/server | `src/modules/compliance/repositories/snapshot.repository.ts` |
| Service | apps/server | `src/modules/compliance/services/snapshot.service.ts` |
| Controller | apps/server | `src/modules/compliance/controllers/snapshot.controller.ts` |
| Route | apps/server | `src/modules/compliance/routes/snapshot.routes.ts` |
| View | apps/web | `src/components/compliance/snapshot-list.tsx` |
| Component | apps/web | `src/components/compliance/create-snapshot-button.tsx` |
| API Tests | apps/server | `src/modules/compliance/__tests__/snapshot.service.test.ts` |
| API Tests | apps/server | `src/modules/compliance/__tests__/snapshot.repository.test.ts` |

## Dependencies
- **Blocks:** S-IA-31-2 (PDF export needs snapshot), S-IA-31-3 (comparison needs snapshots)
- **Blocked by:** S-IA-30-1 (compliance computation data to snapshot)
- **Cross-epic:** none

## Notes
- Snapshot captures the full compliance computation result as immutable JSON.
- JSONB storage enables querying within snapshot data if needed.
- 7-year retention aligns with LCME 8-year accreditation cycle plus buffer.
- Consider compressing large snapshots (GZIP) for storage efficiency.
