# S-F-13-2: Verification Workflow

**Epic:** E-13 (Concept Review & Verification)
**Feature:** F-06
**Sprint:** 5
**Lane:** faculty (P3)
**Size:** M

## User Story
As a **Faculty member (Course Director)**, I need approved concepts to transition from TEACHES to TEACHES_VERIFIED with a full audit trail so that verified curriculum mappings are distinguished from unverified extractions.

## Acceptance Criteria
- [ ] On approval: TEACHES relationship replaced with TEACHES_VERIFIED in Neo4j
- [ ] SubConcept status updated to `verified` in Supabase
- [ ] On rejection: TEACHES relationship removed, SubConcept status set to `rejected`
- [ ] Audit trail record: reviewer_id, action (approve/reject/edit), timestamp, reason (for reject), previous_state
- [ ] Audit trail stored in Supabase `concept_reviews` table
- [ ] DualWriteService: Neo4j relationship type swap + Supabase status update
- [ ] Rollback on partial failure: if Neo4j update fails, Supabase status reverts
- [ ] 10-12 API tests for approve flow, reject flow, audit trail creation, rollback, idempotency

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/concept/review.types.ts` |
| Service | apps/server | `src/services/verification.service.ts` |
| Repository | apps/server | `src/repositories/conceptReview.repository.ts` |
| Tests | apps/server | `src/tests/verification.service.test.ts` |

## Dependencies
- **Blocks:** none
- **Blocked by:** S-F-12-4 (TEACHES relationships must exist)
- **Cross-epic:** none

## Notes
- Neo4j relationship type swap: DELETE `(Course)-[:TEACHES]->(SubConcept)`, CREATE `(Course)-[:TEACHES_VERIFIED]->(SubConcept)` in a single transaction
- TEACHES_VERIFIED carries properties: verified_by, verified_at, from original TEACHES: source_content_id, created_at
- Audit trail is append-only: never update or delete review records
- Verification is idempotent: approving an already-verified concept is a no-op
- Custom error class: `ConceptAlreadyReviewedError` for double-review attempts
