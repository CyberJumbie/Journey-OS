# S-IA-28-1: Coverage Computation Service

**Epic:** E-28 (Coverage Computation & Heatmap)
**Feature:** F-13
**Sprint:** 8
**Lane:** institutional_admin (P2)
**Size:** M

## User Story
As an **Institutional Admin**, I need a coverage computation service that traverses the Neo4j knowledge graph to calculate assessment coverage statistics so that I can understand how well our question bank covers the USMLE curriculum.

## Acceptance Criteria
- [ ] CoverageComputationService with constructor DI for Neo4j repository
- [ ] Computes coverage matrix: 16 USMLE Systems x 7 USMLE Disciplines
- [ ] Coverage score per cell = (assessed concepts / total concepts) for that system-discipline intersection
- [ ] Coverage data includes: score (0-1), assessed_count, total_count, gap_count per cell
- [ ] Supports filtering by institution, program, course, and academic year
- [ ] Results cached in Supabase `coverage_snapshots` table with timestamp
- [ ] Incremental computation: only recalculate cells affected by new questions since last snapshot
- [ ] CoverageRepository for CRUD on coverage snapshots
- [ ] 10-12 API tests: full computation, filtered computation, caching, incremental update, edge cases (empty graph, single course)
- [ ] Named exports only, TypeScript strict

## Implementation Layers
| Layer | Package | Files |
|-------|---------|-------|
| Types | packages/types | `src/coverage/coverage.types.ts` |
| Model | apps/server | `src/models/coverage-snapshot.model.ts` |
| Repository | apps/server | `src/repositories/coverage.repository.ts` |
| Service | apps/server | `src/services/coverage/coverage-computation.service.ts` |
| Controller | apps/server | `src/controllers/coverage.controller.ts` |
| Tests | apps/server | `src/tests/coverage/coverage-computation.test.ts`, `src/tests/coverage/coverage.repository.test.ts` |

## Dependencies
- **Blocks:** S-IA-28-2, S-IA-28-3, S-IA-28-4, S-IA-28-5, S-IA-29-1
- **Blocked by:** S-F-12-4 (TEACHES relationships exist), S-U-16-4 (frameworks seeded)
- **Cross-epic:** S-F-12-4 (Sprint 5 concept relationships), S-U-16-4 (Sprint 5 framework seeding)

## Notes
- Neo4j traversal path: `(Question)-[:ASSESSES]->(SubConcept)-[:PART_OF]->(Concept)-[:BELONGS_TO]->(USMLE_Topic)-[:IN_SYSTEM]->(USMLE_System)` and `...-[:IN_DISCIPLINE]->(USMLE_Discipline)`
- USMLE Systems (16): Cardiovascular, Respiratory, Renal/Urinary, Gastrointestinal, Endocrine, Reproductive, Musculoskeletal, Skin/Subcutaneous, Nervous/Special Senses, Hematopoietic/Lymphoreticular, Immune, Behavioral/Emotional, Biostatistics/Epidemiology, Multisystem, Nutrition, Pharmacology
- USMLE Disciplines (7): Anatomy, Biochemistry, Pathology, Pharmacology, Physiology, Microbiology, Behavioral Science
- Cache TTL: 24 hours default, invalidated on new question creation
- Coverage snapshot stored as JSONB matrix for fast retrieval
